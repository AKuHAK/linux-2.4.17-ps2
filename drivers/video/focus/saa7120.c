//	saa7120.c

//	Copyright (c) 2000-2002, FOCUS Enhancements, Inc.  All Rights Reserved.

//	This file implements a function to set up the companion SAA7120.

#include "trace.h"
#include "FS460.h"
#include "saa7120.h"


// ==========================================================================
//
// NTSC and PAL register contents

static int ntsc[] =
{
	0x26, 0x00,
	0x27, 0x00,
	0x28, 0x19,
	0x29, 0x1D,
	0x3A, 0x03,
	0x5A, 0x0C,
	0x5B, 0x76,
	0x5C, 0xA5,
	0x5D, 0x2A,
	0x5E, 0x2E,
	0x5F, 0x2E,
	0x60, 0x00,
	0x61, 0x15,
	0x62, 0x3F,
	0x63, 0x1F,
	0x64, 0x7C,
	0x65, 0xF0,
	0x66, 0x21,
	0x67, 0x55,
	0x68, 0x56,
	0x69, 0x67,
	0x6A, 0x58,
	0x6B, 0x20,
	0x6C, 0xFA,
	0x6D, 0x00,
	0x6E, 0xB0,
	0x6F, 0x14,
	0x70, 0x80,
	0x71, 0xE8,
	0x72, 0x10,
	0x73, 0x42,
	0x74, 0x03,
	0x75, 0x03,
	0x76, 0x05,
	0x77, 0x16,
	0x78, 0x04,
	0x79, 0x16,
	0x7A, 0x18,
	0x7B, 0x38,
	0x7C, 0x40,
	0x7D, 0x00,
	0x7E, 0x00,
	0x7F, 0x00
};

#define	SIZENTSC (sizeof(ntsc) / sizeof(*ntsc))

static int pal[] =
{
	0x26, 0x00,
	0x27, 0x00,
	0x28, 0x21,
	0x29, 0x1D,
	0x3A, 0x03,
	0x5A, 0x0C,
	0x5B, 0x7D,
	0x5C, 0xAF,
	0x5D, 0x23,
	0x5E, 0x35,
	0x5F, 0x35,
	0x60, 0x00,
	0x61, 0x06,
	0x62, 0x2F,
	0x63, 0xCB,
	0x64, 0x8A,
	0x65, 0x09,
	0x66, 0x2A,
	0x67, 0x55,
	0x68, 0x56,
	0x69, 0x67,
	0x6A, 0x58,
	0x6B, 0x20,
	0x6C, 0x05,
	0x6D, 0x20,
	0x6E, 0xA0,
	0x6F, 0x14,
	0x70, 0x80,
	0x71, 0xE8,
	0x72, 0x10,
	0x73, 0x42,
	0x74, 0x03,
	0x75, 0x03,
	0x76, 0x05,
	0x77, 0x16,
	0x78, 0x04,
	0x79, 0x16,
	0x7A, 0x18,
	0x7B, 0x38,
	0x7C, 0x40,
	0x7D, 0x00,
	0x7E, 0x00,
	0x7F, 0x00
};

#define	SIZEPAL	(sizeof(pal) / sizeof(*pal))


// ==========================================================================
//
// This function sets the 7120 registers for the specified TV standard.
//
// pal: 1 for PAL mode, 0 for NTSC.

int saa7120_set(int ispal)
{
	int err;
	S_FS460_REG_INFO reg;
	int k;

	TRACE(("saa7120_set()\n"))

	reg.source = -(0x46);
	reg.size = 1;

	if (ispal)
	{
		for (k = 0; k < SIZEPAL; k += 2)
		{
			reg.offset = pal[k];
			reg.value = pal[k + 1];
			err = FS460_write_register(&reg);
			if (err) return err;
		}
	}
	else
	{
		for (k = 0; k < SIZENTSC; k += 2)
		{
			reg.offset = ntsc[k];
			reg.value = ntsc[k + 1];
			err = FS460_write_register(&reg);
			if (err) return err;
		}
	}

	return 0;
}
